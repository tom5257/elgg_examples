

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Routing &mdash; Elgg 1.x documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Elgg 1.x documentation" href="../index.html"/>
        <link rel="up" title="Developer Guides" href="index.html"/>
        <link rel="next" title="Themes" href="themes.html"/>
        <link rel="prev" title="River" href="river.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
        <a href="../index.html"><img src="../_static/elgg_logo.png" alt="Elgg" /></a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/features.html">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html">Bundled plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/license.html">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/development.html">Developer Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Administrator Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../admin/getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/upgrading.html">Upgrading Elgg</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/performance.html">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/cron.html">Cron</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/backup-restore.html">Backup and Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/duplicate-installation.html">Duplicate Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/getting-help.html">Getting Help</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dont-modify-core.html">Don&#8217;t Modify Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="guidelines.html">Plugin coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="accessibility.html">Accessibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="ajax.html">Ajax</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="context.html">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Forms + Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="helpers.html">Helper functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html">Internationalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html">JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="menus.html">Menus</a></li>
<li class="toctree-l2"><a class="reference internal" href="notifications.html">Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="pagehandler.html">Page handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="page-owner.html">Page ownership</a></li>
<li class="toctree-l2"><a class="reference internal" href="permissions-check.html">Permissions Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">Plugin settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="river.html">River</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="themes.html">Themes</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html">Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets.html">Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="walled-garden.html">Walled Garden</a></li>
<li class="toctree-l2"><a class="reference internal" href="web-services.html">Web services</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html">Upgrading Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="events-list.html">List of events in core</a></li>
<li class="toctree-l2"><a class="reference internal" href="hooks-list.html">List of plugin hooks in core</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Plugin Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/hello_world.html">Hello world</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/indexpage.html">Customizing the Home Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/blog.html">Building a Blog Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/wysiwyg.html">Integrating a Rich Text Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/widget.html">Basic Widget</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design Docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/events.html">Events and Plugin Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/i18n.html">Internationalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/amd.html">AMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/loggable.html">Loggable</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contributor Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/i18n.html">Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/issues.html">Reporting Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/code.html">Writing Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/docs.html">Writing Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/docs.html#internationalizing-documentation">Internationalizing documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/money.html">Becoming a Financial Supporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/releases.html">Release Process Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix/faqs.html">FAQs and Other Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/roadmap.html">Roadmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/releases.html">Release Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/support.html">Support policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/history.html">History</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Elgg</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Developer Guides</a> &raquo;</li>
      
    <li>Routing</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/guides/routing.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="routing">
<h1>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h1>
<p>Elgg has two mechanisms to respond to HTTP requests that don&#8217;t already go through the
<a class="reference internal" href="../design/actions.html"><em>Actions</em></a> and <a class="reference internal" href="views/simplecache.html"><em>Simplecache</em></a> systems.</p>
<div class="section" id="url-identifier-and-segments">
<h2>URL Identifier and Segments<a class="headerlink" href="#url-identifier-and-segments" title="Permalink to this headline">¶</a></h2>
<p>After removing the site URL, Elgg splits the URL path by <code class="docutils literal"><span class="pre">/</span></code> into an array. The first
element, the <strong>identifier</strong>, is shifted off, and the remaining elements are called the
<strong>segments</strong>. For example, if the site URL is <code class="docutils literal"><span class="pre">http://example.com/elgg/</span></code>, the URL
<code class="docutils literal"><span class="pre">http://example.com/elgg/blog/owner/jane?foo=123</span></code> produces:</p>
<p>Identifier: <code class="docutils literal"><span class="pre">'blog'</span></code>. Segments: <code class="docutils literal"><span class="pre">['owner',</span> <span class="pre">'jane']</span></code>. (the query string parameters are
available via <code class="docutils literal"><span class="pre">get_input()</span></code>)</p>
<p>The site URL (home page) is a special case that produces an empty string identifier and
an empty segments array.</p>
</div>
<div class="section" id="page-handler">
<h2>Page Handler<a class="headerlink" href="#page-handler" title="Permalink to this headline">¶</a></h2>
<p>To handle all URLs that begin with a particular identifier, you can register a function to
act as a <a class="reference internal" href="pagehandler.html"><em>Page handler</em></a>. When the handler is called, the segments array is
passed in as the first argument.</p>
<p>The following code registers a page handler for &#8220;blog&#8221; URLs and shows how one might route
the request to a resource view.</p>
<div class="code php highlight-python"><div class="highlight"><pre>elgg_register_page_handler(&#39;blog&#39;, &#39;blog_page_handler&#39;);

function blog_page_handler(array $segments) {
     // if the URL is http://example.com/elgg/blog/view/123/my-blog-post
     // $segments contains: [&#39;view&#39;, &#39;123&#39;, &#39;my-blog-post&#39;]

     $subpage = elgg_extract(0, $segments);
     if ($subpage === &#39;view&#39;) {

         // use a view for the page logic to allow other plugins to easily change it
         set_input(&#39;guid&#39;, (int)elgg_extract(1, $segments));
         echo elgg_view(&#39;resources/blog/view&#39;);

         // in page handlers, return true says, &quot;we&#39;ve handled this request&quot;
         return true;
     }

     // ... handle other subpages
}
</pre></div>
</div>
</div>
<div class="section" id="the-route-plugin-hook">
<h2>The <code class="docutils literal"><span class="pre">route</span></code> Plugin Hook<a class="headerlink" href="#the-route-plugin-hook" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">route</span></code> plugin hook is triggered earlier, before page handlers are called. The URL
identifier is given as the type of the hook. This hook can be used to modify the identifier
or segments, to take over page rendering completely, or just to add some logic before the
request is handled elsewhere.</p>
<p>Generally devs should use a page handler unless they need to affect a single page or a wider variety of URLs.</p>
<p>The following code intercepts requests to the page handler for <code class="docutils literal"><span class="pre">customblog</span></code> and internally redirects them
to the <code class="docutils literal"><span class="pre">blog</span></code> page handler.</p>
<div class="code php highlight-python"><div class="highlight"><pre>function myplugin_customblog_route_handler($hook, $type, $returnvalue, $params) {
    // direct Elgg to use the page handler for &#39;blog&#39;
    $returnvalue[&#39;identifier&#39;] = &#39;blog&#39;;
    return $returnvalue;
}

elgg_register_plugin_hook_handler(&#39;route&#39;, &#39;customblog&#39;, &#39;myplugin_customblog_route_handler&#39;);
</pre></div>
</div>
<p>The following code results in <code class="docutils literal"><span class="pre">/blog/all</span></code> requests being completely handled by the plugin hook handler.
For these requests the <code class="docutils literal"><span class="pre">blog</span></code> page handler is never called.</p>
<div class="code php highlight-python"><div class="highlight"><pre>function myplugin_blog_all_handler($hook, $type, $returnvalue, $params) {
    $segments = elgg_extract(&#39;segments&#39;, $returnvalue, array());

    if (isset($segments[0]) &amp;&amp; $segments[0] === &#39;all&#39;) {
        $title = &quot;We&#39;re taking over!&quot;;
        $content = elgg_view_layout(&#39;one_column&#39;, array(
            &#39;title&#39; =&gt; $title,
            &#39;content&#39; =&gt; &quot;We can take over page rendering completely&quot;
        ));
        echo elgg_view_page($title, $content);

        // in the route hook, return false says, &quot;stop rendering, we&#39;ve handled this request&quot;
        return false;
    }
}

elgg_register_plugin_hook_handler(&#39;route&#39;, &#39;blog&#39;, &#39;myplugin_blog_all_handler&#39;);
</pre></div>
</div>
</div>
<div class="section" id="routing-overview">
<h2>Routing overview<a class="headerlink" href="#routing-overview" title="Permalink to this headline">¶</a></h2>
<p>For regular pages, Elgg&#8217;s program flow is something like this:</p>
<ol class="arabic simple">
<li>A user requests <code class="docutils literal"><span class="pre">http://example.com/blog/owner/jane</span></code>.</li>
<li>Plugins are initialized.</li>
<li>Elgg parses the URL to identifier <code class="docutils literal"><span class="pre">blog</span></code> and segments <code class="docutils literal"><span class="pre">['owner',</span> <span class="pre">'jane']</span></code>.</li>
<li>Elgg triggers the plugin hook <code class="docutils literal"><span class="pre">route,</span> <span class="pre">blog</span></code> (see above).</li>
<li>Elgg finds a registered page handler (see above) for <code class="docutils literal"><span class="pre">blog</span></code>, and calls the function, passing in
the segments.</li>
<li>The page handler function determines it needs to render a single user&#8217;s blog. It stores the username
via <code class="docutils literal"><span class="pre">set_input()</span></code> and calls the view <code class="docutils literal"><span class="pre">resources/blog/owner</span></code>.</li>
<li>The <code class="docutils literal"><span class="pre">resources/blog/owner</span></code> view gets the username via <code class="docutils literal"><span class="pre">get_input()</span></code>, and uses many other views and
formatting functions like <code class="docutils literal"><span class="pre">elgg_view_layout()</span></code> and <code class="docutils literal"><span class="pre">elgg_view_page()</span></code> to create the entire HTML page.</li>
<li>The page handler echos the view HTML and returns <code class="docutils literal"><span class="pre">true</span></code> to indicate it handled the request.</li>
<li>PHP invokes Elgg&#8217;s shutdown sequence.</li>
<li>The user receives a fully rendered page.</li>
</ol>
<p>Elgg&#8217;s coding standards suggest a particular URL layout, but there is no syntax enforced.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="themes.html" class="btn btn-neutral float-right" title="Themes">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="river.html" class="btn btn-neutral" title="River"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Various.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a modified version of the <a href="https://github.com/snide/sphinx_rtd_theme">Read the Docs theme</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.x',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
   

</body>
</html>